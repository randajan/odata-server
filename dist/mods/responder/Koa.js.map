{
  "version": 3,
  "sources": ["../../../src/mods/responder/Koa.js"],
  "sourcesContent": ["import jet from \"@randajan/jet-core\";\r\n\r\nconst { solid } = jet.prop;\r\n\r\nexport class KoaResponder {\r\n\r\n    constructor(context) {\r\n        solid.all(this, {context});\r\n    }\r\n\r\n    getURL() {\r\n        return this.context.request.url;\r\n    }\r\n\r\n    getMethod() {\r\n        return this.context.request.method;\r\n    }\r\n\r\n    async getBody() {\r\n        const ctx = this.context;\r\n        const req = ctx.request;\r\n\r\n        const body = ctx.body || req.body;\r\n\r\n        if (body) { return body; }\r\n    \r\n        return new Promise((res, rej) => {\r\n            let body = \"\";\r\n            req.on('data', data => {\r\n                if ((body += data).length > 1e6) { rej({ statusCode: 400, msg: \"Request is too long\" }); }\r\n            });\r\n            req.on('end', _ => {\r\n                try { res(body ? JSON.parse(body) : undefined); }\r\n                catch(e) { rej({ statusCode:400, msg:e.message }); }\r\n            });\r\n        });\r\n    }\r\n\r\n    getType() {\r\n        const accepts = this.request.accepts([\"json\", \"xml\"]);\r\n        if (!Array.isArray(accepts)) { return; }\r\n        const xml = accepts.includes(\"xml\");\r\n        const json = accepts.includes(\"json\");\r\n        if (xml !== json) { return xml ? \"xml\" : \"json\"; }\r\n    }\r\n\r\n    setHeader(name, value) {\r\n        this.context.set(name, value);\r\n    }\r\n\r\n    setBody(statusCode, body) {\r\n        this.context.status = statusCode;\r\n        this.context.body = body;\r\n    }\r\n    \r\n}\r\n\r\nexport default (ctx)=>new KoaResponder(ctx);"],
  "mappings": ";AAAA,OAAO,SAAS;AAEhB,IAAM,EAAE,MAAM,IAAI,IAAI;AAEf,IAAM,eAAN,MAAmB;AAAA,EAEtB,YAAY,SAAS;AACjB,UAAM,IAAI,MAAM,EAAC,QAAO,CAAC;AAAA,EAC7B;AAAA,EAEA,SAAS;AACL,WAAO,KAAK,QAAQ,QAAQ;AAAA,EAChC;AAAA,EAEA,YAAY;AACR,WAAO,KAAK,QAAQ,QAAQ;AAAA,EAChC;AAAA,EAEA,MAAM,UAAU;AACZ,UAAM,MAAM,KAAK;AACjB,UAAM,MAAM,IAAI;AAEhB,UAAM,OAAO,IAAI,QAAQ,IAAI;AAE7B,QAAI,MAAM;AAAE,aAAO;AAAA,IAAM;AAEzB,WAAO,IAAI,QAAQ,CAAC,KAAK,QAAQ;AAC7B,UAAIA,QAAO;AACX,UAAI,GAAG,QAAQ,UAAQ;AACnB,aAAKA,SAAQ,MAAM,SAAS,KAAK;AAAE,cAAI,EAAE,YAAY,KAAK,KAAK,sBAAsB,CAAC;AAAA,QAAG;AAAA,MAC7F,CAAC;AACD,UAAI,GAAG,OAAO,OAAK;AACf,YAAI;AAAE,cAAIA,QAAO,KAAK,MAAMA,KAAI,IAAI,MAAS;AAAA,QAAG,SAC1C,GAAN;AAAW,cAAI,EAAE,YAAW,KAAK,KAAI,EAAE,QAAQ,CAAC;AAAA,QAAG;AAAA,MACvD,CAAC;AAAA,IACL,CAAC;AAAA,EACL;AAAA,EAEA,UAAU;AACN,UAAM,UAAU,KAAK,QAAQ,QAAQ,CAAC,QAAQ,KAAK,CAAC;AACpD,QAAI,CAAC,MAAM,QAAQ,OAAO,GAAG;AAAE;AAAA,IAAQ;AACvC,UAAM,MAAM,QAAQ,SAAS,KAAK;AAClC,UAAM,OAAO,QAAQ,SAAS,MAAM;AACpC,QAAI,QAAQ,MAAM;AAAE,aAAO,MAAM,QAAQ;AAAA,IAAQ;AAAA,EACrD;AAAA,EAEA,UAAU,MAAM,OAAO;AACnB,SAAK,QAAQ,IAAI,MAAM,KAAK;AAAA,EAChC;AAAA,EAEA,QAAQ,YAAY,MAAM;AACtB,SAAK,QAAQ,SAAS;AACtB,SAAK,QAAQ,OAAO;AAAA,EACxB;AAEJ;AAEA,IAAO,cAAQ,CAAC,QAAM,IAAI,aAAa,GAAG;",
  "names": ["body"]
}
